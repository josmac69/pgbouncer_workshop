[databases]
; Database definitions
; Format: dbname = host=hostname port=port dbname=dbname
testdb1 = host=postgres port=5432 dbname=testdb1
testdb2 = host=postgres port=5432 dbname=testdb2
postgres = host=postgres port=5432 dbname=postgres

[pgbouncer]
; Connection settings
listen_addr = 0.0.0.0
listen_port = 6432
unix_socket_dir = /tmp

; Authentication
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

; Pool mode
pool_mode = session

; ====================================
; CONNECTION LIMITING PARAMETERS
; ====================================

; Maximum number of server connections per database
; Prevents any single database from consuming all available connections
max_db_connections = 5

; Maximum number of server connections per user (across all databases)
; Prevents any single user from consuming all available connections
max_user_connections = 3

; Maximum number of client connections per user (across all databases)
; This is the total number of client connections a user can have to PgBouncer
; Note: This is different from max_user_connections which limits server connections
max_client_conn = 100

; Default pool size per user/database pair
default_pool_size = 10

; Reserve pool for when default_pool_size is exhausted
reserve_pool_size = 2

; Minimum pool size
min_pool_size = 1

; ====================================
; ADDITIONAL SETTINGS
; ====================================

; Server idle timeout (in seconds)
; Close server connections that have been idle for this long
server_idle_timeout = 600

; How long to wait for server connection (in seconds)
server_connect_timeout = 15

; Query timeout (in seconds)
query_timeout = 0

; Client idle timeout (in seconds)
client_idle_timeout = 0

; ====================================
; LOGGING
; ====================================

; Logging settings
logfile = /var/log/pgbouncer/pgbouncer.log
pidfile = /var/run/pgbouncer/pgbouncer.pid

; Log queries
log_connections = 1
log_disconnections = 1
log_pooler_errors = 1

; Verbosity
verbose = 1

; ====================================
; ADMIN ACCESS
; ====================================

; Admin users - can use admin console
admin_users = admin

; Stats users - can view stats but not modify
stats_users = admin, monitor
